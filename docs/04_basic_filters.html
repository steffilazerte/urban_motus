<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.549">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Steffi LaZerte">
<meta name="dcterms.date" content="2024-02-14">

<title>Motus tracking of urban migration stopovers - Basic Filtering</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./05_fine_filters.html" rel="next">
<link href="./03_range_maps.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script src="site_libs/quarto-contrib/glightbox/glightbox.min.js"></script>
<link href="site_libs/quarto-contrib/glightbox/glightbox.min.css" rel="stylesheet">
<link href="site_libs/quarto-contrib/glightbox/lightbox.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./00_workflow.html">Workflow</a></li><li class="breadcrumb-item"><a href="./04_basic_filters.html">Basic Filtering</a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Motus tracking of urban migration stopovers</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/steffilazerte/urban_motus" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-github"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Workflow</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./00_workflow.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Plans</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01_select_projects.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Selecting Projects</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02_download.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Download/Update Data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03_range_maps.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Range Maps</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04_basic_filters.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Basic Filtering</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05_fine_filters.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Fine-scale Filtering</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./99_checks.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Metadata checks</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Appendicies</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./XX_details.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Notes &amp; Details</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./XX_setup.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Setup</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./XX_citations.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Citations</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active" data-toc-expanded="99">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#setup" id="toc-setup" class="nav-link active" data-scroll-target="#setup">Setup</a>
  <ul class="collapse">
  <li><a href="#custom-tables" id="toc-custom-tables" class="nav-link" data-scroll-target="#custom-tables">Custom tables</a></li>
  </ul></li>
  <li><a href="#non-deployments" id="toc-non-deployments" class="nav-link" data-scroll-target="#non-deployments">Non-deployments</a></li>
  <li><a href="#time" id="toc-time" class="nav-link" data-scroll-target="#time">Time</a></li>
  <li><a href="#space" id="toc-space" class="nav-link" data-scroll-target="#space">Space</a></li>
  <li><a href="#looking-at-the-filters" id="toc-looking-at-the-filters" class="nav-link" data-scroll-target="#looking-at-the-filters">Looking at the filters</a></li>
  <li><a href="#wrap-up" id="toc-wrap-up" class="nav-link" data-scroll-target="#wrap-up">Wrap up</a></li>
  <li><a href="#reproducibility" id="toc-reproducibility" class="nav-link" data-scroll-target="#reproducibility">Reproducibility</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/steffilazerte/urban_motus/edit/main/04_basic_filters.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/steffilazerte/urban_motus/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./00_workflow.html">Workflow</a></li><li class="breadcrumb-item"><a href="./04_basic_filters.html">Basic Filtering</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Basic Filtering</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Steffi LaZerte </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">February 14, 2024</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<p>Here we apply broad filters for missing details, time, space, and species. We’ll omit runs missing deployment information for tags and receivers, runs which occur during times we’re not interested in, and runs which occur for species/receiver pairs which are not within a particular species’ range (ranges were determined in <a href="03_range_maps.html">Range Maps</a>), also omitting species we’re not interested in.</p>
<p>The idea is to reduce the size of the data we’re working with as much as possible before we get into the fine details of assessing data quality.</p>
<p>However, we don’t want to simply delete records in our original .motus databases because</p>
<ul>
<li>we’re working with databases which may need to be updated</li>
<li>we can’t go back if we change our criteria</li>
</ul>
<p>So we will create lists of all the run/tagID combinations <em>to be removed</em>, and we’ll store these as a new table inside the databases.</p>
<p>When we want to calculate our final summaries, we can apply these filters in the last step <em>before</em> <code>collect()</code>ing (flattening) the database.</p>
<section id="setup" class="level2">
<h2 class="anchored" data-anchor-id="setup">Setup</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"XX_setup.R"</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>recvs <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"Data/Datasets/receivers.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="custom-tables" class="level3">
<h3 class="anchored" data-anchor-id="custom-tables">Custom tables</h3>
<p>Normally, we would use the <code>allruns</code> view from our .motus data bases.</p>
<p>However, this view includes a lot of data that we don’t need and I find it faster to pull out the variables we’re interested by hand using a custom function, <code>custom_runs()</code>.</p>
<div class="callout callout-style-simple callout-important no-icon callout-titled" title="Caution">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Caution
</div>
</div>
<div class="callout-body-container callout-body">
<p>That being said, there are some complex joins going on in the <code>allRuns</code> view. I have replicated the relevant ones here, and while I reasonably sure these yield the same data, if there are is any hint that they’re not exactly the same, we should double check.</p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>custom_runs <span class="ot">&lt;-</span> <span class="cf">function</span>(db) {</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Replacement for NULL tsEnd values (i.e. today plus change)</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  max_ts <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">as.numeric</span>(<span class="fu">Sys.time</span>()) <span class="sc">+</span> <span class="dv">1000</span>)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Get Receivers</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  r <span class="ot">&lt;-</span> <span class="fu">tbl</span>(db, <span class="st">"recvDeps"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="st">"deviceID"</span>, <span class="st">"recvDeployID"</span> <span class="ot">=</span> <span class="st">"deployID"</span>, <span class="st">"tsStartRecv"</span> <span class="ot">=</span> <span class="st">"tsStart"</span>, <span class="st">"tsEndRecv"</span> <span class="ot">=</span> <span class="st">"tsEnd"</span>) <span class="sc">|&gt;</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">tsEndRecv =</span> <span class="fu">if_else</span>(<span class="fu">is.na</span>(tsEndRecv), max_ts, tsEndRecv))</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Get tags</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>  t <span class="ot">&lt;-</span> <span class="fu">tbl</span>(db, <span class="st">"tagDeps"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="st">"tagID"</span>, <span class="st">"tagDeployID"</span> <span class="ot">=</span> <span class="st">"deployID"</span>, <span class="st">"speciesID"</span>, <span class="st">"tsStartTag"</span> <span class="ot">=</span> <span class="st">"tsStart"</span>, <span class="st">"tsEndTag"</span> <span class="ot">=</span> <span class="st">"tsEnd"</span>) <span class="sc">|&gt;</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">tsEndTag =</span> <span class="fu">if_else</span>(<span class="fu">is.na</span>(tsEndTag), max_ts, tsEndTag))</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Combine with runs</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tbl</span>(db, <span class="st">"runs"</span>) <span class="sc">|&gt;</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="st">"runID"</span>, <span class="st">"tsBegin"</span>, <span class="st">"tsEnd"</span>, <span class="st">"tagID"</span> <span class="ot">=</span> <span class="st">"motusTagID"</span>, <span class="st">"motusFilter"</span>) <span class="sc">|&gt;</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add in tags by tagID *and* overlap of start/end of tag deployment with the beginning of a run</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">left_join</span>(t, <span class="at">by =</span> <span class="fu">join_by</span>(tagID, <span class="fu">between</span>(tsBegin, tsStartTag, tsEndTag))) <span class="sc">|&gt;</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add in batchRuns by runID (to get the batchID)</span></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">left_join</span>(<span class="fu">tbl</span>(db, <span class="st">"batchRuns"</span>), <span class="at">by =</span> <span class="st">"runID"</span>) <span class="sc">|&gt;</span></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add in batches by batchID (to get the deviceID)</span></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">left_join</span>(<span class="fu">tbl</span>(db, <span class="st">"batches"</span>) <span class="sc">|&gt;</span> <span class="fu">select</span>(<span class="st">"batchID"</span>, <span class="st">"motusDeviceID"</span>), <span class="at">by =</span> <span class="st">"batchID"</span>) <span class="sc">|&gt;</span></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add in receivers by deviceID *and* overlap of receiver deployment time with the beginning of a run</span></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">left_join</span>(r, <span class="at">by =</span> <span class="fu">join_by</span>(motusDeviceID <span class="sc">==</span> deviceID, <span class="fu">between</span>(tsBegin, tsStartRecv, tsEndRecv))) <span class="sc">|&gt;</span></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Keep only relevant data</span></span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(runID, motusFilter, </span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>           tagID, tagDeployID, speciesID, </span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>           recvDeployID, <span class="at">recvDeviceID =</span> motusDeviceID, </span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>           tsBegin, tsEnd) <span class="sc">|&gt;</span></span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">distinct</span>()</span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This function is faster than collecting the <code>allruns</code> view</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">system.time</span>(<span class="fu">tbl</span>(dbs[[<span class="st">"607"</span>]], <span class="st">"allRuns"</span>) <span class="sc">|&gt;</span> <span class="fu">collect</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   user  system elapsed 
  0.758   0.328   1.084 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">system.time</span>(<span class="fu">custom_runs</span>(dbs[[<span class="st">"607"</span>]]) <span class="sc">|&gt;</span> <span class="fu">collect</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   user  system elapsed 
  0.206   0.003   0.210 </code></pre>
</div>
</div>
<p>Get the custom run tables for all databases</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>runs <span class="ot">&lt;-</span> <span class="fu">map</span>(dbs, custom_runs)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="non-deployments" class="level2">
<h2 class="anchored" data-anchor-id="non-deployments">Non-deployments</h2>
<p>Both tags and receivers have device ids and deployment ids. Deployments are associated with a particular device (tag or receiver) being deployed at a certain time.</p>
<p>Many erroneous runs are associated with a tag at a time in which that tag was not recorded as deployed.</p>
<p>Funnily enough this can also occur with receivers where the run occurs at a time where the associated receiver is not recorded as deployed.</p>
<p>This could occur for several reasons:</p>
<ul>
<li>The metadata is incorrect and the tag/receiver was, in fact deployed at that time</li>
<li>This is false positive recording of the tag</li>
<li>This is non-trustworthy receiver data, which may have been collecting during testing or installation</li>
</ul>
<p>As we cannot be sure which is correct, for now we will omit those runs.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true" aria-current="page">Create filter</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false">Explore - Tags</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-3" role="tab" aria-controls="tabset-1-3" aria-selected="false">Explore - Receivers</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<p>In our custom <code>runs</code> tables, any run/tag combination with missing a <code>tagDeployID</code> or a <code>recvDeployID</code> did not actually have a record of the tag/receiver being deployed at that time.</p>
<div class="callout callout-style-simple callout-tip no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<code>speciesID</code> vs.&nbsp;<code>tagDeployID</code>
</div>
</div>
<div class="callout-body-container callout-body">
<p>Technically we should omit those without a tagDeployID, however, looking at the records which <em>have</em> a tagDeployID but do <em>not have</em> a speciesID shows that they are all test tags, so we’ll go ahead and just remove all records missing a speciesID.</p>
<p>See the “Explore - Tags” panel for this exploration</p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>no_tag_dep <span class="ot">&lt;-</span> <span class="fu">map</span>(runs, \(x) <span class="fu">filter</span>(x, <span class="fu">is.na</span>(speciesID)))</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>no_recv_dep <span class="ot">&lt;-</span> <span class="fu">map</span>(runs, \(x) <span class="fu">filter</span>(x, <span class="fu">is.na</span>(recvDeployID)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<p>To be sure that we’re not missing things, we’ll explore what is removed if we use <code>tagDeployID</code> rather than <code>speciesID</code> (as we could conceivibly have tags with a deploy id but not species ids).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>no_tag_dep_check <span class="ot">&lt;-</span> <span class="fu">map</span>(runs, \(x) <span class="fu">filter</span>(x, <span class="fu">is.na</span>(tagDeployID)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>For example, in this project for this tag, we have no species ids for a series of runs.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>no_tag_dep_check[[<span class="st">"484"</span>]] <span class="sc">|&gt;</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(tagID <span class="sc">==</span> <span class="dv">63138</span>) <span class="sc">|&gt;</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect_ts</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 301 × 9
       runID motusFilter tagID tagDeployID speciesID recvDeployID recvDeviceID
       &lt;int&gt;       &lt;dbl&gt; &lt;int&gt;       &lt;int&gt;     &lt;int&gt;        &lt;int&gt;        &lt;int&gt;
 1 462984876           0 63138          NA        NA         8262         2392
 2 462986025           0 63138          NA        NA         8262         2392
 3 462987529           0 63138          NA        NA         8262         2392
 4 475644251           0 63138          NA        NA         8513         2626
 5 475647457           0 63138          NA        NA         8006         2361
 6 477819172           0 63138          NA        NA         8002         2382
 7 478646782           0 63138          NA        NA         8262         2392
 8 480019785           0 63138          NA        NA         7700         1552
 9 481242586           0 63138          NA        NA         8457         2656
10 481245624           0 63138          NA        NA         8457         2656
# ℹ 291 more rows
# ℹ 2 more variables: tsBegin &lt;dttm&gt;, tsEnd &lt;dttm&gt;</code></pre>
</div>
</div>
<p>Note that the <code>motusFilter</code> is also 0, indicating that they are likely false positives based on other metrics as well.</p>
<p>Now if we look at the tag deployment dates for that tag, we see that these runs occurred even before the tag was deployed, further indicating that they are false positives.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tbl</span>(dbs[[<span class="st">"484"</span>]], <span class="st">"tagDeps"</span>) <span class="sc">|&gt;</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(tagID <span class="sc">==</span> <span class="st">"63138"</span>) <span class="sc">|&gt;</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(tagID, deployID, projectID, tsStart, tsEnd, speciesID) <span class="sc">|&gt;</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect_ts</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 6
  tagID deployID projectID tsStart             tsEnd               speciesID
  &lt;int&gt;    &lt;int&gt;     &lt;int&gt; &lt;dttm&gt;              &lt;dttm&gt;                  &lt;int&gt;
1 63138    52117       484 2023-11-10 17:15:00 2025-08-10 17:15:00     19060</code></pre>
</div>
</div>
<p>However, just because we have a tagDeployID, it doesn’t necessarily mean we have a speciesID</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>missing_species <span class="ot">&lt;-</span> <span class="fu">map</span>(runs, \(x) <span class="fu">filter</span>(x, <span class="sc">!</span><span class="fu">is.na</span>(tagDeployID), <span class="fu">is.na</span>(speciesID)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In this example, it is because one deployment is a test deployment</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>missing_species[[<span class="st">"551"</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># Source:   SQL [?? x 9]
# Database: sqlite 3.45.0 [/home/steffi/Projects/Business/Barbara Frei/urban_motus/Data/Raw/project-551.motus]
       runID motusFilter tagID tagDeployID speciesID recvDeployID recvDeviceID
       &lt;int&gt;       &lt;dbl&gt; &lt;int&gt;       &lt;int&gt;     &lt;int&gt;        &lt;int&gt;        &lt;int&gt;
 1 499052332           1 68914       42527        NA           NA         2276
 2 499052376           0 68914       42527        NA         9021         2276
 3 499052378           1 68914       42527        NA         9021         2276
 4 499052381           1 68914       42527        NA         9021         2276
 5 499052382           1 68914       42527        NA         9021         2276
 6 499052384           1 68914       42527        NA         9021         2276
 7 499052386           1 68914       42527        NA         9021         2276
 8 652062609           1 68906       42671        NA         9028         1563
 9 652062673           1 68906       42671        NA         9028         1563
10 652062677           0 68906       42671        NA         9028         1563
# ℹ more rows
# ℹ 2 more variables: tsBegin &lt;dbl&gt;, tsEnd &lt;dbl&gt;</code></pre>
</div>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tbl</span>(dbs[[<span class="st">"551"</span>]], <span class="st">"tagDeps"</span>) <span class="sc">|&gt;</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(tagID <span class="sc">==</span> <span class="dv">68914</span>) <span class="sc">|&gt;</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(tagID, deployID, projectID, test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># Source:   SQL [2 x 4]
# Database: sqlite 3.45.0 [/home/steffi/Projects/Business/Barbara Frei/urban_motus/Data/Raw/project-551.motus]
  tagID deployID projectID  test
  &lt;int&gt;    &lt;int&gt;     &lt;int&gt; &lt;int&gt;
1 68914    42527       551     1
2 68914    43720       551     0</code></pre>
</div>
</div>
<p>And that’s what it looks like for all of them too.</p>
<p>This returns records missing a species id which are NOT tests. Since nothing is returned, they are all tests.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">imap</span>(runs, \(x, y) {</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  x <span class="sc">|&gt;</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(tagDeployID), <span class="fu">is.na</span>(speciesID)) <span class="sc">|&gt;</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">left_join</span>(<span class="fu">tbl</span>(dbs[[y]], <span class="st">"tagDeps"</span>) <span class="sc">|&gt;</span> <span class="fu">select</span>(tagID, deployID, projectID, test),</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>              <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"tagID"</span>, <span class="st">"tagDeployID"</span> <span class="ot">=</span> <span class="st">"deployID"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!</span>test) <span class="sc">|&gt;</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">collect</span>()</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>}) <span class="sc">|&gt;</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list_rbind</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 0 × 11
# ℹ 11 variables: runID &lt;int&gt;, motusFilter &lt;dbl&gt;, tagID &lt;int&gt;,
#   tagDeployID &lt;int&gt;, speciesID &lt;int&gt;, recvDeployID &lt;int&gt;, recvDeviceID &lt;int&gt;,
#   tsBegin &lt;dbl&gt;, tsEnd &lt;dbl&gt;, projectID &lt;int&gt;, test &lt;int&gt;</code></pre>
</div>
</div>
<p>So we can actually remove all records with missing species ids without worry.</p>
</div>
<div id="tabset-1-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-3-tab">
<p>For example, in this project (484) for this receiver device ID (3071), we have no deployment ids (<code>recvDeployID</code>) for a series of runs.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>no_recv_dep_check <span class="ot">&lt;-</span> <span class="fu">map</span>(runs, \(x) <span class="fu">filter</span>(x, <span class="fu">is.na</span>(recvDeployID)))</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>no_recv_dep_check[[<span class="st">"484"</span>]] <span class="sc">|&gt;</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(recvDeviceID <span class="sc">==</span> <span class="st">"3071"</span>) <span class="sc">|&gt;</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect_ts</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 40 × 9
       runID motusFilter tagID tagDeployID speciesID recvDeployID recvDeviceID
       &lt;int&gt;       &lt;dbl&gt; &lt;int&gt;       &lt;int&gt;     &lt;int&gt;        &lt;int&gt;        &lt;int&gt;
 1 540827863           0 62740       41246     18550           NA         3071
 2 540827867           0 62740       41246     18550           NA         3071
 3 540827898           0 62740       41246     18550           NA         3071
 4 540827900           0 62740       41246     18550           NA         3071
 5 540827914           0 62740       41246     18550           NA         3071
 6 540827956           0 62740       41246     18550           NA         3071
 7 540827975           0 62737       41243     18550           NA         3071
 8 540827979           0 62740       41246     18550           NA         3071
 9 540827997           0 62737       41243     18550           NA         3071
10 540828021           0 62740       41246     18550           NA         3071
# ℹ 30 more rows
# ℹ 2 more variables: tsBegin &lt;dttm&gt;, tsEnd &lt;dttm&gt;</code></pre>
</div>
</div>
<p>Now if we look at the receiver deployment dates for that device, we see that these runs occurred before the receiver was deployed, although not that much earlier.</p>
<p>Perhaps these are semi-legitimate runs, which were detected when testing and installing the receiver.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tbl</span>(dbs[[<span class="st">"484"</span>]], <span class="st">"recvDeps"</span>) <span class="sc">|&gt;</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(deviceID <span class="sc">==</span> <span class="st">"3071"</span>) <span class="sc">|&gt;</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(deviceID, deployID, projectID, tsStart, tsEnd, status) <span class="sc">|&gt;</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect_ts</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 6
  deviceID deployID projectID tsStart             tsEnd  status
     &lt;int&gt;    &lt;int&gt;     &lt;int&gt; &lt;dttm&gt;              &lt;dttm&gt; &lt;chr&gt; 
1     3071     9150       354 2022-10-18 18:37:00 NA     active</code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="time" class="level2">
<h2 class="anchored" data-anchor-id="time">Time</h2>
<p>In this filter, we omit times of year that don’t apply to our study. This is the easiest filter to apply as it doesn’t rely on metadata or other variables.</p>
<p><strong>Which dates do we keep?</strong></p>
<ul>
<li>Fall and Spring migration</li>
<li>August - December &amp; February - July</li>
</ul>
<p>Motus date/times are stored as ts in UTC these is a standard number that can be converted to a date time:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as_datetime</span>(<span class="dv">1646289838</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "2022-03-03 06:43:58 UTC"</code></pre>
</div>
</div>
<p>And back</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as.numeric</span>(<span class="fu">as_datetime</span>(<span class="st">"2022-03-03 06:43:58"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1646289838</code></pre>
</div>
</div>
<p>Here we will create a list of time stamp ranges to use when filtering. We’ll create a list of dates from the first year in the data up to the end of the current analysis year.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-2-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-1" role="tab" aria-controls="tabset-2-1" aria-selected="true">Calculate date ranges</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-2" role="tab" aria-controls="tabset-2-2" aria-selected="false">Explore date ranges</a></li></ul>
<div class="tab-content">
<div id="tabset-2-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-2-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>min_year <span class="ot">&lt;-</span> <span class="fu">map_dbl</span>(dbs, \(x) <span class="fu">tbl</span>(x, <span class="st">"runs"</span>) <span class="sc">|&gt;</span> <span class="fu">pull</span>(tsBegin) <span class="sc">|&gt;</span> <span class="fu">min</span>()) <span class="sc">|&gt;</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">min</span>(<span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_datetime</span>() <span class="sc">|&gt;</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">year</span>()</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>max_year <span class="ot">&lt;-</span> <span class="fu">year</span>(<span class="fu">Sys.Date</span>())</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>date_ranges <span class="ot">&lt;-</span> <span class="fu">expand_grid</span>(<span class="at">year =</span> min_year<span class="sc">:</span>max_year, </span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">data.frame</span>(<span class="at">migration =</span> <span class="fu">c</span>(<span class="st">"spring"</span>, <span class="st">"fall"</span>),</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">start =</span> <span class="fu">c</span>(<span class="st">"02-01"</span>, <span class="st">"08-01"</span>),</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">end =</span> <span class="fu">c</span>(<span class="st">"07-01"</span>, <span class="st">"12-01"</span>))) <span class="sc">|&gt;</span></span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">c</span>(<span class="st">"start"</span>, <span class="st">"end"</span>), \(x) <span class="fu">as_datetime</span>(<span class="fu">paste0</span>(year, <span class="st">"-"</span>, x))),</span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>         <span class="fu">across</span>(<span class="fu">c</span>(<span class="st">"start"</span>, <span class="st">"end"</span>), <span class="at">.names =</span> <span class="st">"ts_{.col}"</span>, as.numeric))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-2-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-2-tab">
<p>These are the ranges of dates we want to keep.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gt</span>(date_ranges) <span class="sc">|&gt;</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt_theme</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="wadmyttnzo" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#wadmyttnzo table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#wadmyttnzo thead, #wadmyttnzo tbody, #wadmyttnzo tfoot, #wadmyttnzo tr, #wadmyttnzo td, #wadmyttnzo th {
  border-style: none;
}

#wadmyttnzo p {
  margin: 0;
  padding: 0;
}

#wadmyttnzo .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 3px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#wadmyttnzo .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#wadmyttnzo .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#wadmyttnzo .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#wadmyttnzo .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#wadmyttnzo .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#wadmyttnzo .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 3px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#wadmyttnzo .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: bold;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#wadmyttnzo .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: bold;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#wadmyttnzo .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#wadmyttnzo .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#wadmyttnzo .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 3px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#wadmyttnzo .gt_spanner_row {
  border-bottom-style: hidden;
}

#wadmyttnzo .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#wadmyttnzo .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#wadmyttnzo .gt_from_md > :first-child {
  margin-top: 0;
}

#wadmyttnzo .gt_from_md > :last-child {
  margin-bottom: 0;
}

#wadmyttnzo .gt_row {
  padding-top: 7px;
  padding-bottom: 7px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#wadmyttnzo .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#wadmyttnzo .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#wadmyttnzo .gt_row_group_first td {
  border-top-width: 2px;
}

#wadmyttnzo .gt_row_group_first th {
  border-top-width: 2px;
}

#wadmyttnzo .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#wadmyttnzo .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#wadmyttnzo .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#wadmyttnzo .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#wadmyttnzo .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#wadmyttnzo .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#wadmyttnzo .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#wadmyttnzo .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#wadmyttnzo .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#wadmyttnzo .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#wadmyttnzo .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#wadmyttnzo .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#wadmyttnzo .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#wadmyttnzo .gt_left {
  text-align: left;
}

#wadmyttnzo .gt_center {
  text-align: center;
}

#wadmyttnzo .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#wadmyttnzo .gt_font_normal {
  font-weight: normal;
}

#wadmyttnzo .gt_font_bold {
  font-weight: bold;
}

#wadmyttnzo .gt_font_italic {
  font-style: italic;
}

#wadmyttnzo .gt_super {
  font-size: 65%;
}

#wadmyttnzo .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#wadmyttnzo .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#wadmyttnzo .gt_indent_1 {
  text-indent: 5px;
}

#wadmyttnzo .gt_indent_2 {
  text-indent: 10px;
}

#wadmyttnzo .gt_indent_3 {
  text-indent: 15px;
}

#wadmyttnzo .gt_indent_4 {
  text-indent: 20px;
}

#wadmyttnzo .gt_indent_5 {
  text-indent: 25px;
}
</style>

<table class="gt_table table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="header gt_col_headings">
<th id="year" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">year</th>
<th id="migration" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">migration</th>
<th id="start" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">start</th>
<th id="end" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">end</th>
<th id="ts_start" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">ts_start</th>
<th id="ts_end" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">ts_end</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_right" headers="year">2014</td>
<td class="gt_row gt_left" headers="migration">spring</td>
<td class="gt_row gt_right" headers="start">2014-02-01</td>
<td class="gt_row gt_right" headers="end">2014-07-01</td>
<td class="gt_row gt_right" headers="ts_start">1391212800</td>
<td class="gt_row gt_right" headers="ts_end">1404172800</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="year">2014</td>
<td class="gt_row gt_left" headers="migration">fall</td>
<td class="gt_row gt_right" headers="start">2014-08-01</td>
<td class="gt_row gt_right" headers="end">2014-12-01</td>
<td class="gt_row gt_right" headers="ts_start">1406851200</td>
<td class="gt_row gt_right" headers="ts_end">1417392000</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="year">2015</td>
<td class="gt_row gt_left" headers="migration">spring</td>
<td class="gt_row gt_right" headers="start">2015-02-01</td>
<td class="gt_row gt_right" headers="end">2015-07-01</td>
<td class="gt_row gt_right" headers="ts_start">1422748800</td>
<td class="gt_row gt_right" headers="ts_end">1435708800</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="year">2015</td>
<td class="gt_row gt_left" headers="migration">fall</td>
<td class="gt_row gt_right" headers="start">2015-08-01</td>
<td class="gt_row gt_right" headers="end">2015-12-01</td>
<td class="gt_row gt_right" headers="ts_start">1438387200</td>
<td class="gt_row gt_right" headers="ts_end">1448928000</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="year">2016</td>
<td class="gt_row gt_left" headers="migration">spring</td>
<td class="gt_row gt_right" headers="start">2016-02-01</td>
<td class="gt_row gt_right" headers="end">2016-07-01</td>
<td class="gt_row gt_right" headers="ts_start">1454284800</td>
<td class="gt_row gt_right" headers="ts_end">1467331200</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="year">2016</td>
<td class="gt_row gt_left" headers="migration">fall</td>
<td class="gt_row gt_right" headers="start">2016-08-01</td>
<td class="gt_row gt_right" headers="end">2016-12-01</td>
<td class="gt_row gt_right" headers="ts_start">1470009600</td>
<td class="gt_row gt_right" headers="ts_end">1480550400</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="year">2017</td>
<td class="gt_row gt_left" headers="migration">spring</td>
<td class="gt_row gt_right" headers="start">2017-02-01</td>
<td class="gt_row gt_right" headers="end">2017-07-01</td>
<td class="gt_row gt_right" headers="ts_start">1485907200</td>
<td class="gt_row gt_right" headers="ts_end">1498867200</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="year">2017</td>
<td class="gt_row gt_left" headers="migration">fall</td>
<td class="gt_row gt_right" headers="start">2017-08-01</td>
<td class="gt_row gt_right" headers="end">2017-12-01</td>
<td class="gt_row gt_right" headers="ts_start">1501545600</td>
<td class="gt_row gt_right" headers="ts_end">1512086400</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="year">2018</td>
<td class="gt_row gt_left" headers="migration">spring</td>
<td class="gt_row gt_right" headers="start">2018-02-01</td>
<td class="gt_row gt_right" headers="end">2018-07-01</td>
<td class="gt_row gt_right" headers="ts_start">1517443200</td>
<td class="gt_row gt_right" headers="ts_end">1530403200</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="year">2018</td>
<td class="gt_row gt_left" headers="migration">fall</td>
<td class="gt_row gt_right" headers="start">2018-08-01</td>
<td class="gt_row gt_right" headers="end">2018-12-01</td>
<td class="gt_row gt_right" headers="ts_start">1533081600</td>
<td class="gt_row gt_right" headers="ts_end">1543622400</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="year">2019</td>
<td class="gt_row gt_left" headers="migration">spring</td>
<td class="gt_row gt_right" headers="start">2019-02-01</td>
<td class="gt_row gt_right" headers="end">2019-07-01</td>
<td class="gt_row gt_right" headers="ts_start">1548979200</td>
<td class="gt_row gt_right" headers="ts_end">1561939200</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="year">2019</td>
<td class="gt_row gt_left" headers="migration">fall</td>
<td class="gt_row gt_right" headers="start">2019-08-01</td>
<td class="gt_row gt_right" headers="end">2019-12-01</td>
<td class="gt_row gt_right" headers="ts_start">1564617600</td>
<td class="gt_row gt_right" headers="ts_end">1575158400</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="year">2020</td>
<td class="gt_row gt_left" headers="migration">spring</td>
<td class="gt_row gt_right" headers="start">2020-02-01</td>
<td class="gt_row gt_right" headers="end">2020-07-01</td>
<td class="gt_row gt_right" headers="ts_start">1580515200</td>
<td class="gt_row gt_right" headers="ts_end">1593561600</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="year">2020</td>
<td class="gt_row gt_left" headers="migration">fall</td>
<td class="gt_row gt_right" headers="start">2020-08-01</td>
<td class="gt_row gt_right" headers="end">2020-12-01</td>
<td class="gt_row gt_right" headers="ts_start">1596240000</td>
<td class="gt_row gt_right" headers="ts_end">1606780800</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="year">2021</td>
<td class="gt_row gt_left" headers="migration">spring</td>
<td class="gt_row gt_right" headers="start">2021-02-01</td>
<td class="gt_row gt_right" headers="end">2021-07-01</td>
<td class="gt_row gt_right" headers="ts_start">1612137600</td>
<td class="gt_row gt_right" headers="ts_end">1625097600</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="year">2021</td>
<td class="gt_row gt_left" headers="migration">fall</td>
<td class="gt_row gt_right" headers="start">2021-08-01</td>
<td class="gt_row gt_right" headers="end">2021-12-01</td>
<td class="gt_row gt_right" headers="ts_start">1627776000</td>
<td class="gt_row gt_right" headers="ts_end">1638316800</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="year">2022</td>
<td class="gt_row gt_left" headers="migration">spring</td>
<td class="gt_row gt_right" headers="start">2022-02-01</td>
<td class="gt_row gt_right" headers="end">2022-07-01</td>
<td class="gt_row gt_right" headers="ts_start">1643673600</td>
<td class="gt_row gt_right" headers="ts_end">1656633600</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="year">2022</td>
<td class="gt_row gt_left" headers="migration">fall</td>
<td class="gt_row gt_right" headers="start">2022-08-01</td>
<td class="gt_row gt_right" headers="end">2022-12-01</td>
<td class="gt_row gt_right" headers="ts_start">1659312000</td>
<td class="gt_row gt_right" headers="ts_end">1669852800</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="year">2023</td>
<td class="gt_row gt_left" headers="migration">spring</td>
<td class="gt_row gt_right" headers="start">2023-02-01</td>
<td class="gt_row gt_right" headers="end">2023-07-01</td>
<td class="gt_row gt_right" headers="ts_start">1675209600</td>
<td class="gt_row gt_right" headers="ts_end">1688169600</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="year">2023</td>
<td class="gt_row gt_left" headers="migration">fall</td>
<td class="gt_row gt_right" headers="start">2023-08-01</td>
<td class="gt_row gt_right" headers="end">2023-12-01</td>
<td class="gt_row gt_right" headers="ts_start">1690848000</td>
<td class="gt_row gt_right" headers="ts_end">1701388800</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="year">2024</td>
<td class="gt_row gt_left" headers="migration">spring</td>
<td class="gt_row gt_right" headers="start">2024-02-01</td>
<td class="gt_row gt_right" headers="end">2024-07-01</td>
<td class="gt_row gt_right" headers="ts_start">1706745600</td>
<td class="gt_row gt_right" headers="ts_end">1719792000</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="year">2024</td>
<td class="gt_row gt_left" headers="migration">fall</td>
<td class="gt_row gt_right" headers="start">2024-08-01</td>
<td class="gt_row gt_right" headers="end">2024-12-01</td>
<td class="gt_row gt_right" headers="ts_start">1722470400</td>
<td class="gt_row gt_right" headers="ts_end">1733011200</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
</div>
</div>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-3-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-1" role="tab" aria-controls="tabset-3-1" aria-selected="true">Create filter</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-2" role="tab" aria-controls="tabset-3-2" aria-selected="false">Check filter values</a></li></ul>
<div class="tab-content">
<div id="tabset-3-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-3-1-tab">
<p>Get all runs that are NOT within these dates</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Avoid anti_join() (see Details)</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>dts <span class="ot">&lt;-</span> <span class="fu">select</span>(date_ranges, <span class="st">"migration"</span>, <span class="st">"ts_start"</span>, <span class="st">"ts_end"</span>)</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>noise_time <span class="ot">&lt;-</span> <span class="fu">map</span>(runs, \(x) {</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(x, dts, </span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">by =</span> <span class="fu">join_by</span>(<span class="fu">between</span>(tsBegin, ts_start, ts_end, <span class="at">bounds =</span> <span class="st">"[)"</span>)), </span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">copy =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="fu">is.na</span>(migration)) <span class="sc">|&gt;</span></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span><span class="st">"migration"</span>, <span class="sc">-</span><span class="st">"ts_start"</span>, <span class="sc">-</span><span class="st">"ts_end"</span>)</span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-3-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-2-tab">
<p><strong>Months omitted by filter</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">map</span>(noise_time, \(x) {</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>  x <span class="sc">|&gt;</span> </span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(tsBegin) <span class="sc">|&gt;</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">collect</span>() <span class="sc">|&gt;</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">ts =</span> <span class="fu">as_datetime</span>(tsBegin),</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">month =</span> <span class="fu">month</span>(ts)) <span class="sc">|&gt;</span></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pull</span>(month) <span class="sc">|&gt;</span></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sort</span>() <span class="sc">|&gt;</span></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">unique</span>()</span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>}) <span class="sc">|&gt;</span></span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unlist</span>() <span class="sc">|&gt;</span></span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unique</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]  1  7 12</code></pre>
</div>
</div>
<blockquote class="blockquote">
<p>Good!</p>
</blockquote>
<p><strong>Example of the data omitted</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> runs[[<span class="st">"464"</span>]] <span class="sc">|&gt;</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(runID, tagID, tsBegin) <span class="sc">|&gt;</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(<span class="fu">mutate</span>(noise_time[[<span class="st">"464"</span>]], <span class="at">probability =</span> <span class="dv">0</span>), <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"runID"</span>, <span class="st">"tagID"</span>, <span class="st">"tsBegin"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect</span>() <span class="sc">|&gt;</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">probability =</span> <span class="fu">as.integer</span>(<span class="fu">replace_na</span>(probability, <span class="dv">1</span>)),</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">time =</span> <span class="fu">as_datetime</span>(tsBegin))</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> d, <span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> <span class="fu">factor</span>(tagID), <span class="at">colour =</span> <span class="fu">factor</span>(probability))) <span class="sc">+</span></span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis_d</span>(<span class="at">end =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">caption =</span> <span class="st">"Probability of 0 is data omitted by the filter"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="04_basic_filters_files/figure-html/unnamed-chunk-20-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-1"><img src="04_basic_filters_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid figure-img" width="768"></a></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="space" class="level2">
<h2 class="anchored" data-anchor-id="space">Space</h2>
<p>Here we identify runs which are <em>not</em> associated with appropriate stations as determined by overlap with a species range map (<a href="03_range_maps.html">Range Maps</a>).</p>
<p>These are runs associated with a species which is unlikely to be found at that station and can therefore be assumed to be false positives.</p>
<p>Note that this step <em>also</em> omits species we’re not interested in, as they are not included in the list of species ranges and receivers.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-4-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-1" role="tab" aria-controls="tabset-4-1" aria-selected="true">Create filter</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-2" role="tab" aria-controls="tabset-4-2" aria-selected="false">Check filter values</a></li></ul>
<div class="tab-content">
<div id="tabset-4-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-4-1-tab">
<p>First we’ll add the master list of whether or not a species is in range for each receiver deployment.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>rs <span class="ot">&lt;-</span> recvs <span class="sc">|&gt;</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">speciesID =</span> <span class="fu">as.integer</span>(id), </span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">recvDeployID =</span> <span class="fu">as.integer</span>(deployID)) <span class="sc">|&gt;</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(in_range) <span class="sc">|&gt;</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(speciesID, recvDeployID, in_range)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now, get all runs which are NOT in range given the species and the receiver deployment.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Avoid anti_join() (see Details)</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>noise_space <span class="ot">&lt;-</span> <span class="fu">map</span>(runs, \(x) {</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(x, rs, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"recvDeployID"</span>, <span class="st">"speciesID"</span>), <span class="at">copy =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="fu">is.na</span>(in_range)) <span class="sc">|&gt;</span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span><span class="st">"in_range"</span>)</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-4-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-2-tab">
<p>Many of these omitted are omitted because they are missing the speciesID or the recevDeployID (which is already accounted for the the <a href="#non-depoloyments">Non-deployments</a> section above.</p>
<p>However, let’s take a look at the remaining ones to check.</p>
<p>Hmm, most of these are poor quality runs (i.e.&nbsp;the <code>motusFilter</code> is 0). So this is a good sign that these are indeed false positives which should be omitted.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">map</span>(noise_space, \(x) {</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>  x <span class="sc">|&gt;</span> </span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(speciesID), <span class="sc">!</span><span class="fu">is.na</span>(recvDeployID)) <span class="sc">|&gt;</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">count</span>(motusFilter) <span class="sc">|&gt;</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">collect</span>()</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>}) <span class="sc">|&gt;</span></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list_rbind</span>(<span class="at">names_to =</span> <span class="st">"proj_id"</span>) <span class="sc">|&gt;</span></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt</span>() <span class="sc">|&gt;</span></span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt_theme</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="hnmmnvdwpz" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#hnmmnvdwpz table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#hnmmnvdwpz thead, #hnmmnvdwpz tbody, #hnmmnvdwpz tfoot, #hnmmnvdwpz tr, #hnmmnvdwpz td, #hnmmnvdwpz th {
  border-style: none;
}

#hnmmnvdwpz p {
  margin: 0;
  padding: 0;
}

#hnmmnvdwpz .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 3px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#hnmmnvdwpz .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#hnmmnvdwpz .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#hnmmnvdwpz .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#hnmmnvdwpz .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#hnmmnvdwpz .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#hnmmnvdwpz .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 3px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#hnmmnvdwpz .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: bold;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#hnmmnvdwpz .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: bold;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#hnmmnvdwpz .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#hnmmnvdwpz .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#hnmmnvdwpz .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 3px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#hnmmnvdwpz .gt_spanner_row {
  border-bottom-style: hidden;
}

#hnmmnvdwpz .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#hnmmnvdwpz .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#hnmmnvdwpz .gt_from_md > :first-child {
  margin-top: 0;
}

#hnmmnvdwpz .gt_from_md > :last-child {
  margin-bottom: 0;
}

#hnmmnvdwpz .gt_row {
  padding-top: 7px;
  padding-bottom: 7px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#hnmmnvdwpz .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#hnmmnvdwpz .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#hnmmnvdwpz .gt_row_group_first td {
  border-top-width: 2px;
}

#hnmmnvdwpz .gt_row_group_first th {
  border-top-width: 2px;
}

#hnmmnvdwpz .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#hnmmnvdwpz .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#hnmmnvdwpz .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#hnmmnvdwpz .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#hnmmnvdwpz .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#hnmmnvdwpz .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#hnmmnvdwpz .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#hnmmnvdwpz .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#hnmmnvdwpz .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#hnmmnvdwpz .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#hnmmnvdwpz .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#hnmmnvdwpz .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#hnmmnvdwpz .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#hnmmnvdwpz .gt_left {
  text-align: left;
}

#hnmmnvdwpz .gt_center {
  text-align: center;
}

#hnmmnvdwpz .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#hnmmnvdwpz .gt_font_normal {
  font-weight: normal;
}

#hnmmnvdwpz .gt_font_bold {
  font-weight: bold;
}

#hnmmnvdwpz .gt_font_italic {
  font-style: italic;
}

#hnmmnvdwpz .gt_super {
  font-size: 65%;
}

#hnmmnvdwpz .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#hnmmnvdwpz .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#hnmmnvdwpz .gt_indent_1 {
  text-indent: 5px;
}

#hnmmnvdwpz .gt_indent_2 {
  text-indent: 10px;
}

#hnmmnvdwpz .gt_indent_3 {
  text-indent: 15px;
}

#hnmmnvdwpz .gt_indent_4 {
  text-indent: 20px;
}

#hnmmnvdwpz .gt_indent_5 {
  text-indent: 25px;
}
</style>

<table class="gt_table table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="header gt_col_headings">
<th id="proj_id" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">proj_id</th>
<th id="motusFilter" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">motusFilter</th>
<th id="n" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">n</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_right" headers="proj_id">484</td>
<td class="gt_row gt_right" headers="motusFilter">0</td>
<td class="gt_row gt_right" headers="n">28156</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="proj_id">484</td>
<td class="gt_row gt_right" headers="motusFilter">1</td>
<td class="gt_row gt_right" headers="n">76</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="proj_id">551</td>
<td class="gt_row gt_right" headers="motusFilter">0</td>
<td class="gt_row gt_right" headers="n">1748</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="proj_id">551</td>
<td class="gt_row gt_right" headers="motusFilter">1</td>
<td class="gt_row gt_right" headers="n">5</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="proj_id">373</td>
<td class="gt_row gt_right" headers="motusFilter">0</td>
<td class="gt_row gt_right" headers="n">72</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="proj_id">168</td>
<td class="gt_row gt_right" headers="motusFilter">0</td>
<td class="gt_row gt_right" headers="n">685</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="proj_id">352</td>
<td class="gt_row gt_right" headers="motusFilter">0</td>
<td class="gt_row gt_right" headers="n">1574</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="proj_id">352</td>
<td class="gt_row gt_right" headers="motusFilter">1</td>
<td class="gt_row gt_right" headers="n">11</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="proj_id">364</td>
<td class="gt_row gt_right" headers="motusFilter">0</td>
<td class="gt_row gt_right" headers="n">1866</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="proj_id">364</td>
<td class="gt_row gt_right" headers="motusFilter">1</td>
<td class="gt_row gt_right" headers="n">275</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="proj_id">393</td>
<td class="gt_row gt_right" headers="motusFilter">0</td>
<td class="gt_row gt_right" headers="n">18134</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="proj_id">393</td>
<td class="gt_row gt_right" headers="motusFilter">1</td>
<td class="gt_row gt_right" headers="n">68</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="proj_id">417</td>
<td class="gt_row gt_right" headers="motusFilter">0</td>
<td class="gt_row gt_right" headers="n">10861</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="proj_id">417</td>
<td class="gt_row gt_right" headers="motusFilter">1</td>
<td class="gt_row gt_right" headers="n">8</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="proj_id">464</td>
<td class="gt_row gt_right" headers="motusFilter">0</td>
<td class="gt_row gt_right" headers="n">1536</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="proj_id">464</td>
<td class="gt_row gt_right" headers="motusFilter">1</td>
<td class="gt_row gt_right" headers="n">3</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="proj_id">515</td>
<td class="gt_row gt_right" headers="motusFilter">0</td>
<td class="gt_row gt_right" headers="n">389</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="proj_id">515</td>
<td class="gt_row gt_right" headers="motusFilter">1</td>
<td class="gt_row gt_right" headers="n">2</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="proj_id">607</td>
<td class="gt_row gt_right" headers="motusFilter">0</td>
<td class="gt_row gt_right" headers="n">95</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Let’s take a closer look at one species in one project.</p>
<p>There is quite possibly a lot of noise (see the amount of scatter in the <code>motusFilter = 0</code> category. And clearly this individual (Spotted Towhee) had a home base in southern BC.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>ns <span class="ot">&lt;-</span> noise_space[[<span class="dv">1</span>]] <span class="sc">|&gt;</span> </span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(speciesID <span class="sc">==</span> <span class="dv">18550</span>) <span class="sc">|&gt;</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="st">"runID"</span>, <span class="st">"tagID"</span>) <span class="sc">|&gt;</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">in_range =</span> <span class="dv">0</span>)</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>coords <span class="ot">&lt;-</span> <span class="fu">tbl</span>(dbs[[<span class="st">"484"</span>]], <span class="st">"recvDeps"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="st">"deployID"</span>, <span class="st">"latitude"</span>, <span class="st">"longitude"</span>)</span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>rn <span class="ot">&lt;-</span> <span class="fu">filter</span>(runs[[<span class="st">"484"</span>]], speciesID <span class="sc">==</span> <span class="dv">18550</span>) <span class="sc">|&gt;</span></span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(coords, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"recvDeployID"</span> <span class="ot">=</span> <span class="st">"deployID"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(ns, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"runID"</span>, <span class="st">"tagID"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(latitude), <span class="sc">!</span><span class="fu">is.na</span>(longitude)) <span class="sc">|&gt;</span></span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(motusFilter, tagDeployID, tsBegin, tsEnd, in_range, latitude, longitude) <span class="sc">|&gt;</span></span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect</span>() <span class="sc">|&gt;</span></span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">in_range =</span> <span class="fu">factor</span>(<span class="fu">replace_na</span>(in_range, <span class="dv">1</span>)))</span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a>map <span class="ot">&lt;-</span> <span class="fu">ne_countries</span>(<span class="at">country =</span> <span class="fu">c</span>(<span class="st">"Canada"</span>, <span class="st">"United States of America"</span>), <span class="at">returnclass =</span> <span class="st">"sf"</span>)</span>
<span id="cb38-19"><a href="#cb38-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-20"><a href="#cb38-20" aria-hidden="true" tabindex="-1"></a>rn_sf_cnt <span class="ot">&lt;-</span> rn <span class="sc">|&gt;</span></span>
<span id="cb38-21"><a href="#cb38-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">n =</span> <span class="fu">n</span>(), <span class="at">.by =</span> <span class="fu">c</span>(<span class="st">"motusFilter"</span>, <span class="st">"in_range"</span>, <span class="st">"latitude"</span>, <span class="st">"longitude"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb38-22"><a href="#cb38-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>(<span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"longitude"</span>, <span class="st">"latitude"</span>), <span class="at">crs =</span> <span class="dv">4326</span>)</span>
<span id="cb38-23"><a href="#cb38-23" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb38-24"><a href="#cb38-24" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(rn_sf_cnt) <span class="sc">+</span></span>
<span id="cb38-25"><a href="#cb38-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> map) <span class="sc">+</span></span>
<span id="cb38-26"><a href="#cb38-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">colour =</span> in_range, <span class="at">size =</span> n)) <span class="sc">+</span></span>
<span id="cb38-27"><a href="#cb38-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>motusFilter)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="04_basic_filters_files/figure-html/unnamed-chunk-24-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-2"><img src="04_basic_filters_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="looking-at-the-filters" class="level2">
<h2 class="anchored" data-anchor-id="looking-at-the-filters">Looking at the filters</h2>
<p>First we’ll combine and collect the ‘bad’ runs.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>noise <span class="ot">&lt;-</span> <span class="fu">pmap</span>(<span class="fu">list</span>(no_recv_dep, no_tag_dep, noise_time, noise_space), \(w, x, y, z) {</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map</span>(<span class="fu">list</span>(w, x, y, z), \(a) <span class="fu">collect</span>(<span class="fu">select</span>(a, <span class="st">"runID"</span>, <span class="st">"tagID"</span>))) <span class="sc">|&gt;</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list_rbind</span>() <span class="sc">|&gt;</span> </span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">distinct</span>() <span class="sc">|&gt;</span></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">BAD =</span> <span class="dv">1</span>)</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Next we’ll take a look at how this compares to the motusFilter</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">count</span>(runs[[<span class="dv">1</span>]], motusFilter)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># Source:   SQL [2 x 2]
# Database: sqlite 3.45.0 [/home/steffi/Projects/Business/Barbara Frei/urban_motus/Data/Raw/project-484.motus]
  motusFilter      n
        &lt;dbl&gt;  &lt;int&gt;
1           0 492942
2           1 601907</code></pre>
</div>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">count</span>(<span class="fu">anti_join_quick</span>(runs[[<span class="dv">1</span>]], noise[[<span class="dv">1</span>]], <span class="at">copy =</span> <span class="cn">TRUE</span>), motusFilter)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># Source:   SQL [2 x 2]
# Database: sqlite 3.45.0 [/home/steffi/Projects/Business/Barbara Frei/urban_motus/Data/Raw/project-484.motus]
  motusFilter      n
        &lt;dbl&gt;  &lt;int&gt;
1           0 305817
2           1 416234</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">walk2</span>(dbs, noise, \(x, y) {</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="st">"bad_data"</span> <span class="sc">%in%</span> <span class="fu">dbListTables</span>(x)) <span class="fu">dbRemoveTable</span>(x, <span class="at">name =</span> <span class="st">"bad_data"</span>)</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dbCreateTable</span>(x, <span class="at">name =</span> <span class="st">"bad_data"</span>, <span class="at">fields =</span> y)</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dbAppendTable</span>(x, <span class="at">name =</span> <span class="st">"bad_data"</span>, <span class="at">value =</span> y)</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="wrap-up" class="level2">
<h2 class="anchored" data-anchor-id="wrap-up">Wrap up</h2>
<p>Disconnect from the databases</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">walk</span>(dbs, dbDisconnect)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="reproducibility" class="level2">
<h2 class="anchored" data-anchor-id="reproducibility">Reproducibility</h2>
<div class="callout callout-style-simple callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-3-contents" aria-controls="callout-3" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Session Info
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-3" class="callout-3-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">session_info</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>─ Session info ───────────────────────────────────────────────────────────────
 setting  value
 version  R version 4.3.2 (2023-10-31)
 os       Ubuntu 22.04.3 LTS
 system   x86_64, linux-gnu
 ui       X11
 language en_CA:en
 collate  en_CA.UTF-8
 ctype    en_CA.UTF-8
 tz       America/Winnipeg
 date     2024-02-14
 pandoc   3.1.1 @ /usr/lib/rstudio/resources/app/bin/quarto/bin/tools/ (via rmarkdown)

─ Packages ───────────────────────────────────────────────────────────────────
 package       * version  date (UTC) lib source
 assertr       * 3.0.0    2022-11-05 [1] CRAN (R 4.3.0)
 bit             4.0.5    2022-11-15 [1] CRAN (R 4.3.0)
 bit64           4.0.5    2020-08-30 [1] CRAN (R 4.3.0)
 blob            1.2.4    2023-03-17 [1] CRAN (R 4.3.0)
 cachem          1.0.8    2023-05-01 [1] CRAN (R 4.3.0)
 callr           3.7.3    2022-11-02 [1] CRAN (R 4.3.0)
 class           7.3-22   2023-05-03 [4] CRAN (R 4.3.1)
 classInt        0.4-10   2023-09-05 [1] CRAN (R 4.3.1)
 cli             3.6.2    2023-12-11 [1] CRAN (R 4.3.2)
 colorspace      2.1-0    2023-01-23 [1] CRAN (R 4.3.0)
 crayon          1.5.2    2022-09-29 [1] CRAN (R 4.3.0)
 DBI           * 1.2.1    2024-01-12 [1] CRAN (R 4.3.2)
 dbplyr          2.4.0    2023-10-26 [1] CRAN (R 4.3.1)
 devtools        2.4.5    2022-10-11 [1] CRAN (R 4.3.0)
 digest          0.6.34   2024-01-11 [1] CRAN (R 4.3.2)
 dplyr         * 1.1.4    2023-11-17 [1] CRAN (R 4.3.2)
 e1071           1.7-14   2023-12-06 [1] CRAN (R 4.3.2)
 ebirdst       * 3.2022.2 2024-01-15 [1] Github (ebird/ebirdst@bd409c7)
 ellipsis        0.3.2    2021-04-29 [1] CRAN (R 4.3.0)
 evaluate        0.23     2023-11-01 [1] CRAN (R 4.3.1)
 fansi           1.0.6    2023-12-08 [1] CRAN (R 4.3.2)
 farver          2.1.1    2022-07-06 [1] CRAN (R 4.3.0)
 fastmap         1.1.1    2023-02-24 [1] CRAN (R 4.3.0)
 fs              1.6.3    2023-07-20 [1] CRAN (R 4.3.1)
 generics        0.1.3    2022-07-05 [1] CRAN (R 4.3.0)
 ggplot2       * 3.4.4    2023-10-12 [1] CRAN (R 4.3.1)
 glue            1.7.0    2024-01-09 [1] CRAN (R 4.3.2)
 gt            * 0.10.0   2023-10-07 [1] CRAN (R 4.3.1)
 gtable          0.3.4    2023-08-21 [1] CRAN (R 4.3.1)
 hms             1.1.3    2023-03-21 [1] CRAN (R 4.3.0)
 htmltools       0.5.7    2023-11-03 [1] CRAN (R 4.3.1)
 htmlwidgets     1.6.4    2023-12-06 [1] CRAN (R 4.3.2)
 httpuv          1.6.12   2023-10-23 [1] CRAN (R 4.3.1)
 httr            1.4.7    2023-08-15 [1] CRAN (R 4.3.1)
 jsonlite        1.8.8    2023-12-04 [1] CRAN (R 4.3.2)
 KernSmooth      2.23-22  2023-07-10 [1] CRAN (R 4.3.1)
 knitr           1.45     2023-10-30 [1] CRAN (R 4.3.1)
 labeling        0.4.3    2023-08-29 [1] CRAN (R 4.3.1)
 later           1.3.1    2023-05-02 [1] CRAN (R 4.3.1)
 lattice         0.22-5   2023-10-24 [4] CRAN (R 4.3.1)
 lifecycle       1.0.4    2023-11-07 [1] CRAN (R 4.3.2)
 lubridate     * 1.9.3    2023-09-27 [1] CRAN (R 4.3.1)
 magrittr        2.0.3    2022-03-30 [1] CRAN (R 4.3.0)
 memoise         2.0.1    2021-11-26 [1] CRAN (R 4.3.0)
 mime            0.12     2021-09-28 [1] CRAN (R 4.3.0)
 miniUI          0.1.1.1  2018-05-18 [1] CRAN (R 4.3.0)
 motus         * 6.1.0    2024-02-01 [1] Github (motuswts/motus@9d99ed5)
 munsell         0.5.0    2018-06-12 [1] CRAN (R 4.3.0)
 naturecounts    0.4.0    2023-06-20 [1] local
 pillar          1.9.0    2023-03-22 [1] CRAN (R 4.3.0)
 pkgbuild        1.4.2    2023-06-26 [1] CRAN (R 4.3.1)
 pkgconfig       2.0.3    2019-09-22 [1] CRAN (R 4.3.0)
 pkgload         1.3.3    2023-09-22 [1] CRAN (R 4.3.1)
 prettyunits     1.2.0    2023-09-24 [1] CRAN (R 4.3.1)
 processx        3.8.2    2023-06-30 [1] CRAN (R 4.3.1)
 profvis         0.3.8    2023-05-02 [1] CRAN (R 4.3.1)
 promises        1.2.1    2023-08-10 [1] CRAN (R 4.3.1)
 proxy           0.4-27   2022-06-09 [1] CRAN (R 4.3.0)
 ps              1.7.5    2023-04-18 [1] CRAN (R 4.3.0)
 purrr         * 1.0.2    2023-08-10 [1] CRAN (R 4.3.1)
 R6              2.5.1    2021-08-19 [1] CRAN (R 4.3.0)
 Rcpp            1.0.12   2024-01-09 [1] CRAN (R 4.3.2)
 readr         * 2.1.5    2024-01-10 [1] CRAN (R 4.3.2)
 remotes         2.4.2.1  2023-07-18 [1] CRAN (R 4.3.2)
 rlang           1.1.3    2024-01-10 [1] CRAN (R 4.3.2)
 rmarkdown       2.25     2023-09-18 [1] CRAN (R 4.3.1)
 rnaturalearth * 0.3.4    2023-08-21 [1] CRAN (R 4.3.1)
 RSQLite         2.3.5    2024-01-21 [1] CRAN (R 4.3.2)
 rstudioapi      0.15.0   2023-07-07 [1] CRAN (R 4.3.1)
 sass            0.4.8    2023-12-06 [1] CRAN (R 4.3.2)
 scales          1.3.0    2023-11-28 [1] CRAN (R 4.3.2)
 sessioninfo     1.2.2    2021-12-06 [1] CRAN (R 4.3.0)
 sf            * 1.0-14   2023-07-11 [1] CRAN (R 4.3.1)
 shiny           1.7.5.1  2023-10-14 [1] CRAN (R 4.3.1)
 sp              2.1-1    2023-10-16 [1] CRAN (R 4.3.1)
 stringi         1.8.3    2023-12-11 [1] CRAN (R 4.3.2)
 stringr       * 1.5.1    2023-11-14 [1] CRAN (R 4.3.2)
 tibble        * 3.2.1    2023-03-20 [1] CRAN (R 4.3.0)
 tidyr         * 1.3.1    2024-01-24 [1] CRAN (R 4.3.2)
 tidyselect      1.2.0    2022-10-10 [1] CRAN (R 4.3.0)
 timechange      0.3.0    2024-01-18 [1] CRAN (R 4.3.2)
 tzdb            0.4.0    2023-05-12 [1] CRAN (R 4.3.1)
 units         * 0.8-4    2023-09-13 [1] CRAN (R 4.3.1)
 urlchecker      1.0.1    2021-11-30 [1] CRAN (R 4.3.0)
 usethis         2.2.2    2023-07-06 [1] CRAN (R 4.3.1)
 utf8            1.2.4    2023-10-22 [1] CRAN (R 4.3.1)
 vctrs           0.6.5    2023-12-01 [1] CRAN (R 4.3.2)
 viridisLite     0.4.2    2023-05-02 [1] CRAN (R 4.3.1)
 vroom           1.6.5    2023-12-05 [1] CRAN (R 4.3.2)
 withr           3.0.0    2024-01-16 [1] CRAN (R 4.3.2)
 xfun            0.41     2023-11-01 [1] CRAN (R 4.3.1)
 xml2            1.3.6    2023-12-04 [1] CRAN (R 4.3.2)
 xtable          1.8-4    2019-04-21 [1] CRAN (R 4.3.0)
 yaml            2.3.8    2023-12-11 [1] CRAN (R 4.3.2)

 [1] /home/steffi/R/x86_64-pc-linux-gnu-library/4.3
 [2] /usr/local/lib/R/site-library
 [3] /usr/lib/R/site-library
 [4] /usr/lib/R/library

──────────────────────────────────────────────────────────────────────────────</code></pre>
</div>
</div>
</div>
</div>
</div>


</section>

<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./03_range_maps.html" class="pagination-link  aria-label=" range="" maps"="">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Range Maps</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./05_fine_filters.html" class="pagination-link" aria-label="Fine-scale Filtering">
        <span class="nav-page-text">Fine-scale Filtering</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/steffilazerte/urban_motus/edit/main/04_basic_filters.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/steffilazerte/urban_motus/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div></div></footer><script>var lightboxQuarto = GLightbox({"descPosition":"bottom","selector":".lightbox","openEffect":"zoom","loop":false,"closeEffect":"zoom"});
window.onload = () => {
  lightboxQuarto.on('slide_before_load', (data) => {
    const { slideIndex, slideNode, slideConfig, player, trigger } = data;
    const href = trigger.getAttribute('href');
    if (href !== null) {
      const imgEl = window.document.querySelector(`a[href="${href}"] img`);
      if (imgEl !== null) {
        const srcAttr = imgEl.getAttribute("src");
        if (srcAttr && srcAttr.startsWith("data:")) {
          slideConfig.href = srcAttr;
        }
      }
    } 
  });

  lightboxQuarto.on('slide_after_load', (data) => {
    const { slideIndex, slideNode, slideConfig, player, trigger } = data;
    if (window.Quarto?.typesetMath) {
      window.Quarto.typesetMath(slideNode);
    }
  });

};
          </script>




</body></html>