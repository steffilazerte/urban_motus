<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.549">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Steffi LaZerte">
<meta name="dcterms.date" content="2024-05-03">

<title>Motus tracking of urban migration stopovers - Basic Filtering</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./05_fine_filters.html" rel="next">
<link href="./03_range_maps.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script src="site_libs/quarto-contrib/glightbox/glightbox.min.js"></script>
<link href="site_libs/quarto-contrib/glightbox/glightbox.min.css" rel="stylesheet">
<link href="site_libs/quarto-contrib/glightbox/lightbox.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./00_workflow.html">Workflow</a></li><li class="breadcrumb-item"><a href="./04_basic_filters.html">Basic Filtering</a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Motus tracking of urban migration stopovers</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/steffilazerte/urban_motus" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-github"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Workflow</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./00_workflow.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Plans</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01_select_projects.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Selecting Projects</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02_download.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Download/Update Data &amp; Transform</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03_range_maps.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Range Maps</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04_basic_filters.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Basic Filtering</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05_fine_filters.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Fine-scale Filtering</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06_bouts_transitions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bouts and Transitions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07_find_problems.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Finding Problems</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08_manual_adjustments.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Manual Adjustments</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09_summaries.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Summaries</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./99_checks.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Metadata checks</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Appendicies</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./XX_details.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Notes &amp; Details</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./XX_setup.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Setup</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./XX_citations.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Citations</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active" data-toc-expanded="99">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#setup" id="toc-setup" class="nav-link active" data-scroll-target="#setup">Setup</a></li>
  <li><a href="#non-deployments" id="toc-non-deployments" class="nav-link" data-scroll-target="#non-deployments">Non-deployments</a></li>
  <li><a href="#time" id="toc-time" class="nav-link" data-scroll-target="#time">Time</a></li>
  <li><a href="#space" id="toc-space" class="nav-link" data-scroll-target="#space">Space</a></li>
  <li><a href="#duplicate-runids" id="toc-duplicate-runids" class="nav-link" data-scroll-target="#duplicate-runids">Duplicate runIDs</a></li>
  <li><a href="#looking-at-the-filters" id="toc-looking-at-the-filters" class="nav-link" data-scroll-target="#looking-at-the-filters">Looking at the filters</a></li>
  <li><a href="#saving-filters" id="toc-saving-filters" class="nav-link" data-scroll-target="#saving-filters">Saving filters</a></li>
  <li><a href="#wrap-up" id="toc-wrap-up" class="nav-link" data-scroll-target="#wrap-up">Wrap up</a></li>
  <li><a href="#reproducibility" id="toc-reproducibility" class="nav-link" data-scroll-target="#reproducibility">Reproducibility</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/steffilazerte/urban_motus/edit/main/04_basic_filters.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/steffilazerte/urban_motus/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./00_workflow.html">Workflow</a></li><li class="breadcrumb-item"><a href="./04_basic_filters.html">Basic Filtering</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Basic Filtering</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Steffi LaZerte </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">May 3, 2024</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<p>Here we apply broad filters for missing details, time, space, and species. We’ll omit runs missing deployment information for tags and receivers, runs which occur during times we’re not interested in, and runs which occur for species/receiver pairs which are not within a particular species’ range (ranges were determined in <a href="03_range_maps.html">Range Maps</a>), also omitting species we’re not interested in.</p>
<p>The idea is to reduce the size of the data we’re working with as much as possible before we get into the fine details of assessing data quality.</p>
<p>However, we don’t want to simply delete records in our original data because</p>
<ul>
<li>we’re working with data which may need to be updated</li>
<li>we can’t go back if we change our criteria</li>
</ul>
<p>So we will create lists of all the run/tagID combinations <em>to be removed</em>, and we’ll store these as a new dataset.</p>
<p>When we want to calculate our final summaries, we can apply these filters in the last step <em>before</em> <code>collect()</code>ing (flattening) the parquet data files.</p>
<section id="setup" class="level2">
<h2 class="anchored" data-anchor-id="setup">Setup</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"XX_setup.R"</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>recvs <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"Data/Datasets/receivers.csv"</span>)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>runs <span class="ot">&lt;-</span> <span class="fu">open_dataset</span>(<span class="st">"Data/Datasets/runs"</span>, <span class="at">format =</span> <span class="st">"feather"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="non-deployments" class="level2">
<h2 class="anchored" data-anchor-id="non-deployments">Non-deployments</h2>
<p>Both tags and receivers have device ids and deployment ids. Deployments are associated with a particular device (tag or receiver) being deployed at a certain time.</p>
<p>Many erroneous runs are associated with a tag at a time in which that tag was not recorded as deployed.</p>
<p>Funnily enough this can also occur with receivers where the run occurs at a time where the associated receiver is not recorded as deployed.</p>
<p>This could occur for several reasons:</p>
<ul>
<li>The metadata is incorrect and the tag/receiver was, in fact deployed at that time</li>
<li>This is false positive recording of the tag</li>
<li>This is non-trustworthy receiver data, which may have been collecting during testing or installation</li>
</ul>
<p>As we cannot be sure which is correct, for now we will omit those runs.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true" aria-current="page">Create filter</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false">Explore - Tags</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-3" role="tab" aria-controls="tabset-1-3" aria-selected="false">Explore - Receivers</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<p>In our custom <code>runs</code> tables, any run/tag combination with missing a <code>tagDeployID</code> or a <code>recvDeployID</code> did not actually have a record of the tag/receiver being deployed at that time.</p>
<div class="callout callout-style-simple callout-tip no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<code>speciesID</code> vs.&nbsp;<code>tagDeployID</code>
</div>
</div>
<div class="callout-body-container callout-body">
<p>Technically we should omit those without a tagDeployID, however, looking at the records which <em>have</em> a tagDeployID but do <em>not have</em> a speciesID shows that they are all test tags, so we’ll go ahead and just remove all records missing a speciesID.</p>
<p>See the “Explore - Tags” panel for this exploration</p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>no_deps <span class="ot">&lt;-</span> <span class="fu">filter</span>(runs, <span class="fu">is.na</span>(speciesID) <span class="sc">|</span> <span class="fu">is.na</span>(recvDeployID)) <span class="sc">|&gt;</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<p>To be sure that we’re not missing things, we’ll explore what is removed if we use <code>tagDeployID</code> rather than <code>speciesID</code> (as we could conceivably have tags with a deploy id but not species ids).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>no_tag_dep_check <span class="ot">&lt;-</span> <span class="fu">filter</span>(runs, <span class="fu">is.na</span>(tagDeployID))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>For example, in this project for this tag, we have no species ids for a series of runs.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>no_tag_dep_check <span class="sc">|&gt;</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(tagID, tagDeployID, speciesID, tsBegin, tsEnd, motusFilter) <span class="sc">|&gt;</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(tagID <span class="sc">==</span> <span class="dv">63138</span>) <span class="sc">|&gt;</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect_ts</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 301 × 6
   tagID tagDeployID speciesID tsBegin             tsEnd              
   &lt;int&gt;       &lt;int&gt;     &lt;int&gt; &lt;dttm&gt;              &lt;dttm&gt;             
 1 63138          NA        NA 2022-01-15 10:27:31 2022-01-15 10:28:51
 2 63138          NA        NA 2022-01-16 04:26:10 2022-01-16 04:26:50
 3 63138          NA        NA 2022-01-27 01:22:06 2022-01-27 01:22:45
 4 63138          NA        NA 2022-04-11 20:25:47 2022-04-11 20:27:07
 5 63138          NA        NA 2022-04-02 21:10:25 2022-04-02 21:11:45
 6 63138          NA        NA 2022-05-30 21:39:44 2022-05-30 21:41:04
 7 63138          NA        NA 2022-06-02 22:34:33 2022-06-02 22:35:53
 8 63138          NA        NA 2022-02-14 19:55:01 2022-02-14 19:55:41
 9 63138          NA        NA 2022-05-01 01:58:15 2022-05-01 01:59:34
10 63138          NA        NA 2022-07-01 10:04:21 2022-07-01 10:05:41
# ℹ 291 more rows
# ℹ 1 more variable: motusFilter &lt;dbl&gt;</code></pre>
</div>
</div>
<p>Note that the <code>motusFilter</code> is also 0, indicating that they are likely false positives based on other metrics as well.</p>
<p>Now if we look at the tag deployment dates for that tag, we see that these runs occurred even before the tag was deployed, further indicating that they are false positives.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>runs <span class="sc">|&gt;</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(tagID <span class="sc">==</span> <span class="dv">63138</span>) <span class="sc">|&gt;</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(tagID, tagDeployID,  tsStartTag, tsEndTag, speciesID) <span class="sc">|&gt;</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>() <span class="sc">|&gt;</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect_ts</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 5
  tagID tagDeployID tsStartTag          tsEndTag            speciesID
  &lt;int&gt;       &lt;int&gt; &lt;dttm&gt;              &lt;dttm&gt;                  &lt;int&gt;
1 63138          NA NA                  NA                         NA
2 63138       52117 2023-11-10 17:15:00 2025-08-10 17:15:00     19060</code></pre>
</div>
</div>
<p>However, just because we have a tagDeployID, it doesn’t necessarily mean we have a speciesID.</p>
<p>But in all cases where there <em>is</em> a tagDeployID but there <em>is not</em> a speciesID, it’s because the tag is a test tag (<code>test = 1</code>).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>runs <span class="sc">|&gt;</span> </span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(tagDeployID), <span class="fu">is.na</span>(speciesID)) <span class="sc">|&gt;</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(tagID, tagDeployID, test) <span class="sc">|&gt;</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>() <span class="sc">|&gt;</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 13 × 3
   tagID tagDeployID  test
   &lt;int&gt;       &lt;int&gt; &lt;int&gt;
 1 23608       12511     1
 2 26315       16538     1
 3 26448       13848     1
 4 52917       32346     1
 5 68906       42671     1
 6 74330       45876     1
 7 74328       45833     1
 8 74328       45874     1
 9 74331       45877     1
10 74329       45875     1
11 52918       33943     1
12 64024       38571     1
13 68914       42527     1</code></pre>
</div>
</div>
<p>Therefore, we can actually remove all records with missing species ids without worry.</p>
</div>
<div id="tabset-1-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-3-tab">
<p>For example, in this project (484) for this receiver device ID (3071), we have no deployment ids (<code>recvDeployID</code>) for a series of runs.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(runs, <span class="fu">is.na</span>(recvDeployID)) <span class="sc">|&gt;</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(proj_id, recvDeployID, recvDeviceID) <span class="sc">|&gt;</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>() <span class="sc">|&gt;</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 501 × 3
   proj_id recvDeployID recvDeviceID
     &lt;int&gt;        &lt;int&gt;        &lt;int&gt;
 1     364           NA          559
 2     364           NA         3071
 3     364           NA         3179
 4     364           NA         3180
 5     364           NA         2541
 6     364           NA         3207
 7     364           NA         3357
 8     364           NA         3333
 9     364           NA          514
10     168           NA         1882
# ℹ 491 more rows</code></pre>
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(runs, <span class="fu">is.na</span>(recvDeployID)) <span class="sc">|&gt;</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(proj_id <span class="sc">==</span> <span class="dv">484</span>, recvDeviceID <span class="sc">==</span> <span class="dv">3071</span>) <span class="sc">|&gt;</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(proj_id, runID, recvDeployID, recvDeviceID, tagDeployID) <span class="sc">|&gt;</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect_ts</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 40 × 5
   proj_id     runID recvDeployID recvDeviceID tagDeployID
     &lt;int&gt;     &lt;int&gt;        &lt;int&gt;        &lt;int&gt;       &lt;int&gt;
 1     484 540827863           NA         3071       41246
 2     484 540827867           NA         3071       41246
 3     484 540827898           NA         3071       41246
 4     484 540827900           NA         3071       41246
 5     484 540827914           NA         3071       41246
 6     484 540827956           NA         3071       41246
 7     484 540827975           NA         3071       41243
 8     484 540827979           NA         3071       41246
 9     484 540827997           NA         3071       41243
10     484 540828021           NA         3071       41246
# ℹ 30 more rows</code></pre>
</div>
</div>
<p>Now if we look at the receiver deployment dates for that device, we see that these runs occurred before the receiver was deployed, although not that much earlier.</p>
<p>Perhaps these are semi-legitimate runs, which were detected when testing and installing the receiver.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tbl</span>(dbs[[<span class="st">"484"</span>]], <span class="st">"recvDeps"</span>) <span class="sc">|&gt;</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(deviceID <span class="sc">==</span> <span class="st">"3071"</span>) <span class="sc">|&gt;</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(deviceID, deployID, projectID, tsStart, tsEnd, status) <span class="sc">|&gt;</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect_ts</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 6
  deviceID deployID projectID tsStart             tsEnd  status
     &lt;int&gt;    &lt;int&gt;     &lt;int&gt; &lt;dttm&gt;              &lt;dttm&gt; &lt;chr&gt; 
1     3071     9150       354 2022-10-18 18:37:00 NA     active</code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="time" class="level2">
<h2 class="anchored" data-anchor-id="time">Time</h2>
<p>In this filter, we omit times of year that don’t apply to our study. This is the easiest filter to apply as it doesn’t rely on metadata or other variables.</p>
<p><strong>Which dates do we keep?</strong></p>
<ul>
<li>Fall and Spring migration</li>
<li>August - December &amp; February - July</li>
</ul>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-2-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-1" role="tab" aria-controls="tabset-2-1" aria-selected="true">Create filter</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-2" role="tab" aria-controls="tabset-2-2" aria-selected="false">Example of the data omitted</a></li></ul>
<div class="tab-content">
<div id="tabset-2-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-2-1-tab">
<p>Get all runs that are NOT within these dates (Jan, July, Dec)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>noise_time <span class="ot">&lt;-</span> runs <span class="sc">|&gt;</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(monthBegin <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">7</span>, <span class="dv">12</span>)) <span class="sc">|&gt;</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-2-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> runs <span class="sc">|&gt;</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(proj_id <span class="sc">==</span> <span class="dv">464</span>) <span class="sc">|&gt;</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">probability =</span> <span class="fu">if_else</span>(monthBegin <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">7</span>, <span class="dv">12</span>), <span class="dv">0</span>, <span class="dv">1</span>)) <span class="sc">|&gt;</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(runID, tagID, tsBegin, probability, timeBegin) <span class="sc">|&gt;</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect</span>()</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> d, <span class="fu">aes</span>(<span class="at">x =</span> timeBegin, <span class="at">y =</span> <span class="fu">factor</span>(tagID), <span class="at">colour =</span> <span class="fu">factor</span>(probability))) <span class="sc">+</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis_d</span>(<span class="at">end =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">caption =</span> <span class="st">"Probability of 0 is data omitted by the filter"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="04_basic_filters_files/figure-html/unnamed-chunk-11-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-1"><img src="04_basic_filters_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid figure-img" width="768"></a></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="space" class="level2">
<h2 class="anchored" data-anchor-id="space">Space</h2>
<p>Here we identify runs which are <em>not</em> associated with appropriate stations as determined by overlap with a species range map (<a href="03_range_maps.html">Range Maps</a>).</p>
<p>These are runs associated with a species which is unlikely to be found at that station and can therefore be assumed to be false positives.</p>
<p>Note that this step <em>also</em> omits species we’re not interested in, as they are not included in the list of species ranges and receivers.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-3-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-1" role="tab" aria-controls="tabset-3-1" aria-selected="true">Create filter</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-2" role="tab" aria-controls="tabset-3-2" aria-selected="false">Check filter values</a></li></ul>
<div class="tab-content">
<div id="tabset-3-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-3-1-tab">
<p>First we’ll add the master list of whether or not a species is in range for each receiver deployment.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>rs <span class="ot">&lt;-</span> recvs <span class="sc">|&gt;</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">speciesID =</span> <span class="fu">as.integer</span>(id), </span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">recvDeployID =</span> <span class="fu">as.integer</span>(deployID)) <span class="sc">|&gt;</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(in_range) <span class="sc">|&gt;</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(speciesID, recvDeployID, in_range)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now, get all runs which are NOT in range given the species and the receiver deployment.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>noise_space <span class="ot">&lt;-</span> runs <span class="sc">|&gt;</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(rs, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"recvDeployID"</span>, <span class="st">"speciesID"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">is.na</span>(in_range)) <span class="sc">|&gt;</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="st">"in_range"</span>) <span class="sc">|&gt;</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-3-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-2-tab">
<p>Many of these omitted are omitted because they are missing the speciesID or the recevDeployID (which is already accounted for the the <a href="#non-depoloyments">Non-deployments</a> section above.</p>
<p>However, let’s take a look at the remaining ones to check.</p>
<p>Hmm, most of these are poor quality runs (i.e.&nbsp;the <code>motusFilter</code> is 0). So this is a good sign that these are indeed false positives which should be omitted.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>noise_space <span class="sc">|&gt;</span> </span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(speciesID), <span class="sc">!</span><span class="fu">is.na</span>(recvDeployID)) <span class="sc">|&gt;</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(proj_id, motusFilter) <span class="sc">|&gt;</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect</span>() <span class="sc">|&gt;</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt</span>() <span class="sc">|&gt;</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt_theme</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="qdnmloaykv" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#qdnmloaykv table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#qdnmloaykv thead, #qdnmloaykv tbody, #qdnmloaykv tfoot, #qdnmloaykv tr, #qdnmloaykv td, #qdnmloaykv th {
  border-style: none;
}

#qdnmloaykv p {
  margin: 0;
  padding: 0;
}

#qdnmloaykv .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 3px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#qdnmloaykv .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#qdnmloaykv .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#qdnmloaykv .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#qdnmloaykv .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#qdnmloaykv .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#qdnmloaykv .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 3px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#qdnmloaykv .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: bold;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#qdnmloaykv .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: bold;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#qdnmloaykv .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#qdnmloaykv .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#qdnmloaykv .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 3px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#qdnmloaykv .gt_spanner_row {
  border-bottom-style: hidden;
}

#qdnmloaykv .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#qdnmloaykv .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#qdnmloaykv .gt_from_md > :first-child {
  margin-top: 0;
}

#qdnmloaykv .gt_from_md > :last-child {
  margin-bottom: 0;
}

#qdnmloaykv .gt_row {
  padding-top: 7px;
  padding-bottom: 7px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#qdnmloaykv .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#qdnmloaykv .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#qdnmloaykv .gt_row_group_first td {
  border-top-width: 2px;
}

#qdnmloaykv .gt_row_group_first th {
  border-top-width: 2px;
}

#qdnmloaykv .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#qdnmloaykv .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#qdnmloaykv .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#qdnmloaykv .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#qdnmloaykv .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#qdnmloaykv .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#qdnmloaykv .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#qdnmloaykv .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#qdnmloaykv .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#qdnmloaykv .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#qdnmloaykv .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#qdnmloaykv .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#qdnmloaykv .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#qdnmloaykv .gt_left {
  text-align: left;
}

#qdnmloaykv .gt_center {
  text-align: center;
}

#qdnmloaykv .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#qdnmloaykv .gt_font_normal {
  font-weight: normal;
}

#qdnmloaykv .gt_font_bold {
  font-weight: bold;
}

#qdnmloaykv .gt_font_italic {
  font-style: italic;
}

#qdnmloaykv .gt_super {
  font-size: 65%;
}

#qdnmloaykv .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#qdnmloaykv .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#qdnmloaykv .gt_indent_1 {
  text-indent: 5px;
}

#qdnmloaykv .gt_indent_2 {
  text-indent: 10px;
}

#qdnmloaykv .gt_indent_3 {
  text-indent: 15px;
}

#qdnmloaykv .gt_indent_4 {
  text-indent: 20px;
}

#qdnmloaykv .gt_indent_5 {
  text-indent: 25px;
}
</style>

<table class="gt_table table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="header gt_col_headings">
<th id="proj_id" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">proj_id</th>
<th id="motusFilter" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">motusFilter</th>
<th id="n" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">n</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_right" headers="proj_id">168</td>
<td class="gt_row gt_right" headers="motusFilter">0</td>
<td class="gt_row gt_right" headers="n">685</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="proj_id">352</td>
<td class="gt_row gt_right" headers="motusFilter">0</td>
<td class="gt_row gt_right" headers="n">1574</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="proj_id">352</td>
<td class="gt_row gt_right" headers="motusFilter">1</td>
<td class="gt_row gt_right" headers="n">11</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="proj_id">364</td>
<td class="gt_row gt_right" headers="motusFilter">0</td>
<td class="gt_row gt_right" headers="n">1866</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="proj_id">364</td>
<td class="gt_row gt_right" headers="motusFilter">1</td>
<td class="gt_row gt_right" headers="n">275</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="proj_id">373</td>
<td class="gt_row gt_right" headers="motusFilter">0</td>
<td class="gt_row gt_right" headers="n">72</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="proj_id">393</td>
<td class="gt_row gt_right" headers="motusFilter">0</td>
<td class="gt_row gt_right" headers="n">18134</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="proj_id">393</td>
<td class="gt_row gt_right" headers="motusFilter">1</td>
<td class="gt_row gt_right" headers="n">68</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="proj_id">417</td>
<td class="gt_row gt_right" headers="motusFilter">0</td>
<td class="gt_row gt_right" headers="n">10861</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="proj_id">417</td>
<td class="gt_row gt_right" headers="motusFilter">1</td>
<td class="gt_row gt_right" headers="n">8</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="proj_id">464</td>
<td class="gt_row gt_right" headers="motusFilter">0</td>
<td class="gt_row gt_right" headers="n">1536</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="proj_id">464</td>
<td class="gt_row gt_right" headers="motusFilter">1</td>
<td class="gt_row gt_right" headers="n">3</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="proj_id">484</td>
<td class="gt_row gt_right" headers="motusFilter">0</td>
<td class="gt_row gt_right" headers="n">28156</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="proj_id">484</td>
<td class="gt_row gt_right" headers="motusFilter">1</td>
<td class="gt_row gt_right" headers="n">76</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="proj_id">515</td>
<td class="gt_row gt_right" headers="motusFilter">0</td>
<td class="gt_row gt_right" headers="n">389</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="proj_id">515</td>
<td class="gt_row gt_right" headers="motusFilter">1</td>
<td class="gt_row gt_right" headers="n">2</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="proj_id">551</td>
<td class="gt_row gt_right" headers="motusFilter">0</td>
<td class="gt_row gt_right" headers="n">1700</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="proj_id">551</td>
<td class="gt_row gt_right" headers="motusFilter">1</td>
<td class="gt_row gt_right" headers="n">5</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="proj_id">607</td>
<td class="gt_row gt_right" headers="motusFilter">0</td>
<td class="gt_row gt_right" headers="n">95</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Let’s take a closer look at one species in one project.</p>
<p>There is quite possibly a lot of noise (see the amount of scatter in the <code>motusFilter = 0</code> category. And clearly this individual (Spotted Towhee) had a home base in southern BC.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>ns <span class="ot">&lt;-</span> noise_space <span class="sc">|&gt;</span> </span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(proj_id <span class="sc">==</span> <span class="dv">484</span>, speciesID <span class="sc">==</span> <span class="dv">18550</span>) <span class="sc">|&gt;</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="st">"runID"</span>, <span class="st">"tagID"</span>) <span class="sc">|&gt;</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">in_range =</span> <span class="dv">0</span>)</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>coords <span class="ot">&lt;-</span> <span class="fu">tbl</span>(dbs[[<span class="st">"484"</span>]], <span class="st">"recvDeps"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="st">"deployID"</span>, <span class="st">"latitude"</span>, <span class="st">"longitude"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect</span>()</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>rn <span class="ot">&lt;-</span> <span class="fu">filter</span>(runs, proj_id <span class="sc">==</span> <span class="dv">484</span>, speciesID <span class="sc">==</span> <span class="dv">18550</span>) <span class="sc">|&gt;</span></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(coords, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"recvDeployID"</span> <span class="ot">=</span> <span class="st">"deployID"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(ns, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"runID"</span>, <span class="st">"tagID"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(latitude), <span class="sc">!</span><span class="fu">is.na</span>(longitude)) <span class="sc">|&gt;</span></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(motusFilter, tagDeployID, tsBegin, tsEnd, in_range, latitude, longitude) <span class="sc">|&gt;</span></span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect</span>() <span class="sc">|&gt;</span></span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">in_range =</span> <span class="fu">factor</span>(<span class="fu">replace_na</span>(in_range, <span class="dv">1</span>)))</span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>map <span class="ot">&lt;-</span> <span class="fu">ne_countries</span>(<span class="at">country =</span> <span class="fu">c</span>(<span class="st">"Canada"</span>, <span class="st">"United States of America"</span>), <span class="at">returnclass =</span> <span class="st">"sf"</span>)</span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a>rn_sf_cnt <span class="ot">&lt;-</span> rn <span class="sc">|&gt;</span></span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">n =</span> <span class="fu">n</span>(), <span class="at">.by =</span> <span class="fu">c</span>(<span class="st">"motusFilter"</span>, <span class="st">"in_range"</span>, <span class="st">"latitude"</span>, <span class="st">"longitude"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>(<span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"longitude"</span>, <span class="st">"latitude"</span>), <span class="at">crs =</span> <span class="dv">4326</span>)</span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(rn_sf_cnt) <span class="sc">+</span></span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> map) <span class="sc">+</span></span>
<span id="cb21-26"><a href="#cb21-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">colour =</span> in_range, <span class="at">size =</span> n)) <span class="sc">+</span></span>
<span id="cb21-27"><a href="#cb21-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>motusFilter)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="04_basic_filters_files/figure-html/unnamed-chunk-15-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-2"><img src="04_basic_filters_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="duplicate-runids" class="level2">
<h2 class="anchored" data-anchor-id="duplicate-runids">Duplicate runIDs</h2>
<p>Double check that there are no duplicate runIDs, which can happen when joining all the data together if we don’t account for duplicate/overlapping receiver/tag deployments.</p>
<p>Additionally there are some duplicates based on the same runID in different batches… This occurs in <code>allruns</code> too, so isn’t an artifact of the custom joins, but still not idea.</p>
<p>These <em>should</em> have been dealt with in <code>custom_runs()</code> but just in case, we’ll verify here.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>runs <span class="sc">|&gt;</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(runID) <span class="sc">|&gt;</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(n <span class="sc">&gt;</span> <span class="dv">1</span>) <span class="sc">|&gt;</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 0 × 2
# ℹ 2 variables: runID &lt;int&gt;, n &lt;int&gt;</code></pre>
</div>
</div>
<p>Okay, good, there are zero duplicates (zero rows).</p>
</section>
<section id="looking-at-the-filters" class="level2">
<h2 class="anchored" data-anchor-id="looking-at-the-filters">Looking at the filters</h2>
<p>First we’ll combine and collect the ‘bad’ runs.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>noise <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(no_deps, noise_time, noise_space) <span class="sc">|&gt;</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Next we’ll take a look at how this compares to the motusFilter</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">count</span>(runs, proj_id, motusFilter) <span class="sc">|&gt;</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(proj_id <span class="sc">==</span> <span class="dv">484</span>) <span class="sc">|&gt;</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 3
  proj_id motusFilter      n
    &lt;int&gt;       &lt;dbl&gt;  &lt;int&gt;
1     484           0 492931
2     484           1 601907</code></pre>
</div>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anti_join</span>(runs, noise, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"runID"</span>, <span class="st">"tagDeployID"</span>, <span class="st">"recvDeployID"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(proj_id <span class="sc">==</span> <span class="dv">484</span>) <span class="sc">|&gt;</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(proj_id, motusFilter) <span class="sc">|&gt;</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 3
  proj_id motusFilter      n
    &lt;int&gt;       &lt;dbl&gt;  &lt;int&gt;
1     484           0 336867
2     484           1 429134</code></pre>
</div>
</div>
<p>There are still many ‘bad’ data according to the motusFilter… perhaps we should use that as well, or see what happens after we do the next stage of fine scale filtering.</p>
</section>
<section id="saving-filters" class="level2">
<h2 class="anchored" data-anchor-id="saving-filters">Saving filters</h2>
<p>We’ll save the ‘bad data’ for use in the next steps.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write_feather</span>(noise, <span class="at">sink =</span> <span class="st">"Data/Datasets/noise_runs.feather"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="wrap-up" class="level2">
<h2 class="anchored" data-anchor-id="wrap-up">Wrap up</h2>
<p>Disconnect from the databases</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">walk</span>(dbs, dbDisconnect)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="reproducibility" class="level2">
<h2 class="anchored" data-anchor-id="reproducibility">Reproducibility</h2>
<div class="callout callout-style-simple callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-2-contents" aria-controls="callout-2" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Session Info
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-2" class="callout-2-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">session_info</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>─ Session info ───────────────────────────────────────────────────────────────
 setting  value
 version  R version 4.3.3 (2024-02-29)
 os       Ubuntu 22.04.4 LTS
 system   x86_64, linux-gnu
 ui       X11
 language en_CA:en
 collate  en_CA.UTF-8
 ctype    en_CA.UTF-8
 tz       America/Winnipeg
 date     2024-03-08
 pandoc   3.1.1 @ /usr/lib/rstudio/resources/app/bin/quarto/bin/tools/ (via rmarkdown)

─ Packages ───────────────────────────────────────────────────────────────────
 package       * version  date (UTC) lib source
 arrow         * 13.0.0.1 2023-09-22 [1] CRAN (R 4.3.1)
 assertr       * 3.0.0    2022-11-05 [1] CRAN (R 4.3.0)
 assertthat      0.2.1    2019-03-21 [1] CRAN (R 4.3.0)
 bit             4.0.5    2022-11-15 [1] CRAN (R 4.3.0)
 bit64           4.0.5    2020-08-30 [1] CRAN (R 4.3.0)
 blob            1.2.4    2023-03-17 [1] CRAN (R 4.3.0)
 cachem          1.0.8    2023-05-01 [1] CRAN (R 4.3.0)
 class           7.3-22   2023-05-03 [4] CRAN (R 4.3.1)
 classInt        0.4-10   2023-09-05 [1] CRAN (R 4.3.1)
 cli             3.6.2    2023-12-11 [1] CRAN (R 4.3.2)
 codetools       0.2-19   2023-02-01 [4] CRAN (R 4.2.2)
 colorspace      2.1-0    2023-01-23 [1] CRAN (R 4.3.0)
 crayon          1.5.2    2022-09-29 [1] CRAN (R 4.3.0)
 DBI           * 1.2.2    2024-02-16 [1] CRAN (R 4.3.2)
 dbplyr          2.4.0    2023-10-26 [1] CRAN (R 4.3.1)
 devtools        2.4.5    2022-10-11 [1] CRAN (R 4.3.0)
 digest          0.6.34   2024-01-11 [1] CRAN (R 4.3.2)
 dplyr         * 1.1.4    2023-11-17 [1] CRAN (R 4.3.2)
 e1071           1.7-14   2023-12-06 [1] CRAN (R 4.3.2)
 ebirdst       * 3.2022.2 2024-01-15 [1] Github (ebird/ebirdst@bd409c7)
 ellipsis        0.3.2    2021-04-29 [1] CRAN (R 4.3.0)
 evaluate        0.23     2023-11-01 [1] CRAN (R 4.3.1)
 fansi           1.0.6    2023-12-08 [1] CRAN (R 4.3.2)
 farver          2.1.1    2022-07-06 [1] CRAN (R 4.3.0)
 fastmap         1.1.1    2023-02-24 [1] CRAN (R 4.3.0)
 fs              1.6.3    2023-07-20 [1] CRAN (R 4.3.1)
 generics        0.1.3    2022-07-05 [1] CRAN (R 4.3.0)
 ggplot2       * 3.5.0    2024-02-23 [1] CRAN (R 4.3.2)
 glue            1.7.0    2024-01-09 [1] CRAN (R 4.3.2)
 gt            * 0.10.0   2023-10-07 [1] CRAN (R 4.3.1)
 gtable          0.3.4    2023-08-21 [1] CRAN (R 4.3.1)
 hms             1.1.3    2023-03-21 [1] CRAN (R 4.3.0)
 htmltools       0.5.7    2023-11-03 [1] CRAN (R 4.3.1)
 htmlwidgets     1.6.4    2023-12-06 [1] CRAN (R 4.3.2)
 httpuv          1.6.14   2024-01-26 [1] CRAN (R 4.3.2)
 httr            1.4.7    2023-08-15 [1] CRAN (R 4.3.1)
 jsonlite        1.8.8    2023-12-04 [1] CRAN (R 4.3.2)
 KernSmooth      2.23-22  2023-07-10 [1] CRAN (R 4.3.1)
 knitr           1.45     2023-10-30 [1] CRAN (R 4.3.1)
 labeling        0.4.3    2023-08-29 [1] CRAN (R 4.3.1)
 later           1.3.2    2023-12-06 [1] CRAN (R 4.3.2)
 lifecycle       1.0.4    2023-11-07 [1] CRAN (R 4.3.2)
 lubridate     * 1.9.3    2023-09-27 [1] CRAN (R 4.3.1)
 magrittr        2.0.3    2022-03-30 [1] CRAN (R 4.3.0)
 memoise         2.0.1    2021-11-26 [1] CRAN (R 4.3.0)
 mime            0.12     2021-09-28 [1] CRAN (R 4.3.0)
 miniUI          0.1.1.1  2018-05-18 [1] CRAN (R 4.3.0)
 motus         * 6.1.0    2024-02-01 [1] Github (motuswts/motus@9d99ed5)
 munsell         0.5.0    2018-06-12 [1] CRAN (R 4.3.0)
 naturecounts    0.4.0    2023-06-20 [1] local
 pillar          1.9.0    2023-03-22 [1] CRAN (R 4.3.0)
 pkgbuild        1.4.3    2023-12-10 [1] CRAN (R 4.3.2)
 pkgconfig       2.0.3    2019-09-22 [1] CRAN (R 4.3.0)
 pkgload         1.3.3    2023-09-22 [1] CRAN (R 4.3.1)
 profvis         0.3.8    2023-05-02 [1] CRAN (R 4.3.1)
 promises        1.2.1    2023-08-10 [1] CRAN (R 4.3.1)
 proxy           0.4-27   2022-06-09 [1] CRAN (R 4.3.0)
 purrr         * 1.0.2    2023-08-10 [1] CRAN (R 4.3.1)
 R6              2.5.1    2021-08-19 [1] CRAN (R 4.3.0)
 Rcpp            1.0.12   2024-01-09 [1] CRAN (R 4.3.2)
 readr         * 2.1.5    2024-01-10 [1] CRAN (R 4.3.2)
 remotes         2.4.2.1  2023-07-18 [1] CRAN (R 4.3.2)
 rlang           1.1.3    2024-01-10 [1] CRAN (R 4.3.2)
 rmarkdown       2.25     2023-09-18 [1] CRAN (R 4.3.1)
 rnaturalearth * 1.0.1    2023-12-15 [1] CRAN (R 4.3.2)
 RSQLite         2.3.5    2024-01-21 [1] CRAN (R 4.3.2)
 rstudioapi      0.15.0   2023-07-07 [1] CRAN (R 4.3.1)
 sass            0.4.8    2023-12-06 [1] CRAN (R 4.3.2)
 scales          1.3.0    2023-11-28 [1] CRAN (R 4.3.2)
 sessioninfo     1.2.2    2021-12-06 [1] CRAN (R 4.3.0)
 sf            * 1.0-15   2023-12-18 [1] CRAN (R 4.3.2)
 shiny           1.8.0    2023-11-17 [1] CRAN (R 4.3.2)
 stringi         1.8.3    2023-12-11 [1] CRAN (R 4.3.2)
 stringr       * 1.5.1    2023-11-14 [1] CRAN (R 4.3.2)
 terra           1.7-71   2024-01-31 [1] CRAN (R 4.3.2)
 tibble        * 3.2.1    2023-03-20 [1] CRAN (R 4.3.0)
 tidyr         * 1.3.1    2024-01-24 [1] CRAN (R 4.3.2)
 tidyselect      1.2.0    2022-10-10 [1] CRAN (R 4.3.0)
 timechange      0.3.0    2024-01-18 [1] CRAN (R 4.3.2)
 tzdb            0.4.0    2023-05-12 [1] CRAN (R 4.3.1)
 units         * 0.8-5    2023-11-28 [1] CRAN (R 4.3.2)
 urlchecker      1.0.1    2021-11-30 [1] CRAN (R 4.3.0)
 usethis         2.2.2    2023-07-06 [1] CRAN (R 4.3.1)
 utf8            1.2.4    2023-10-22 [1] CRAN (R 4.3.1)
 vctrs           0.6.5    2023-12-01 [1] CRAN (R 4.3.2)
 viridisLite     0.4.2    2023-05-02 [1] CRAN (R 4.3.1)
 vroom           1.6.5    2023-12-05 [1] CRAN (R 4.3.2)
 withr           3.0.0    2024-01-16 [1] CRAN (R 4.3.2)
 xfun            0.42     2024-02-08 [1] CRAN (R 4.3.2)
 xml2            1.3.6    2023-12-04 [1] CRAN (R 4.3.2)
 xtable          1.8-4    2019-04-21 [1] CRAN (R 4.3.0)
 yaml            2.3.8    2023-12-11 [1] CRAN (R 4.3.2)

 [1] /home/steffi/R/x86_64-pc-linux-gnu-library/4.3
 [2] /usr/local/lib/R/site-library
 [3] /usr/lib/R/site-library
 [4] /usr/lib/R/library

──────────────────────────────────────────────────────────────────────────────</code></pre>
</div>
</div>
</div>
</div>
</div>


</section>

<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./03_range_maps.html" class="pagination-link  aria-label=" range="" maps"="">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Range Maps</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./05_fine_filters.html" class="pagination-link" aria-label="Fine-scale Filtering">
        <span class="nav-page-text">Fine-scale Filtering</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/steffilazerte/urban_motus/edit/main/04_basic_filters.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/steffilazerte/urban_motus/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div></div></footer><script>var lightboxQuarto = GLightbox({"openEffect":"zoom","loop":false,"selector":".lightbox","descPosition":"bottom","closeEffect":"zoom"});
window.onload = () => {
  lightboxQuarto.on('slide_before_load', (data) => {
    const { slideIndex, slideNode, slideConfig, player, trigger } = data;
    const href = trigger.getAttribute('href');
    if (href !== null) {
      const imgEl = window.document.querySelector(`a[href="${href}"] img`);
      if (imgEl !== null) {
        const srcAttr = imgEl.getAttribute("src");
        if (srcAttr && srcAttr.startsWith("data:")) {
          slideConfig.href = srcAttr;
        }
      }
    } 
  });

  lightboxQuarto.on('slide_after_load', (data) => {
    const { slideIndex, slideNode, slideConfig, player, trigger } = data;
    if (window.Quarto?.typesetMath) {
      window.Quarto.typesetMath(slideNode);
    }
  });

};
          </script>




</body></html>